%header.navbar.navbar-static-top.primary-nav-header
  .container
    .navbar-header
      %a.navbar-brand{ href: dashboard_url } Aptible
    %nav
      %ul.nav.nav-pills.navbar-right.user-nav
        - if current_user.decorate.cached_organizations.count > 1
          %li.dropdown.current-organization
            .btn-group
              %a.btn.btn-link{ href: organization_url(current_organization.id) }= current_organization.name
              %a.btn.dropdown-toggle{ data: { toggle: 'dropdown' } }
                %i.fa.fa-chevron-down
              %ul.dropdown-menu
                - current_user.decorate.cached_organizations.each do |org|
                  %li
                    - if current_organization.href == org.href
                      %span.org-name.current{ title: "Currently using #{org.name}", data: { toggle: 'tooltip', placement: 'bottom' } }
                        %i.fa.fa-check.success
                        %span.button-label
                          = org.name
                    - else
                      %a.org-name.current{ title: "Switch to #{org.name}", href: dashboard_session_url, data: { org_href: org.href, toggle: 'tooltip', placement: 'bottom'} }
                        = org.name
                    %ul.nav.nav-pills.sub-nav-tabs
                      %li
                        %a{ title: 'Edit Settings', href: organization_url(org.id), data: { toggle: 'tooltip', placement: 'bottom' } }
                          %i.fa.fa-cog
                          %span.button-label Edit Settings
        - else
          %li
            %a{ href: organization_url(current_organization.id) }
              = current_organization.name

        = render partial: '../../vendor/assets/aptible-sass/dist/layouts/user_nav'

      %ul.nav.nav-pills.navbar-right.primary-nav
        %li{ class: ((!local_assigns[:compliance_page] && controller?('apps') || controller?('operations', 'services') && params[:app_id] ) ? 'active' : '') }
          %a{ href: apps_url } Apps
        %li{ class: (controller?('databases') || (controller?('operations') && params[:database_id])? 'active' : '') }
          %a{ href: databases_url } Databases
        %li{ class: (controller?('compliance', 'training_statuses') || local_assigns[:compliance_page]) ? 'active' : '' }
          %a{ href: compliance_url } Compliance

